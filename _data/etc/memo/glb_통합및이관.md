 > **<font size = "6">kor / jpn 데이터를 glb 로 이관시켜야한다..</font>**
---
<br/>

## **전제**
- 모든 데이터를 옮기지 않아도 된다고 한다.
- 국가별로 기획 테이블 내, row 식별자인 index가 아예 다르게 사용되는 경우가 있다.
    - 위와 더불어, ID가 특정 국가에는 아예 없는 것도 있고, 서로 ID가 바뀌어 있는 것도 있다,,,, ( 일본에선 id:3 스킨이 ,, 글로벌에선 id:4 로 사용되고,, 뭐 이런거,,) 
        - 이러한 케이스는 기획에서 필터해서 준다고 한다,, >> 검증 할 방법이 없다,, ㅠㅠ
- 

---

### **이관 방법**
- GameDB + WorldDB : 기존 UserId + @샤딩 범위로 신규 UserID를 만들어 치환
    - KOR/JPN 의 GameDB/WorldD을 UserID 기반의 샤딩(기존 GameDB방식) 으로 통합할 예정, 데이터 베이스 통합은 아니고 분리하여 사용만한다. ( 기존 Identity 로 동작하는 다른 데이터들이 문제없이 이관될 수 없다고 판단함)
    - GameDB는 애초에 샤딩을 가정하고 만들어서 서버 로직에 문제되는 부분이 없을텐데, **_WorldDB 쪽은 샤딩되어 문제되는 것들을 따로 추출_** 하여 확인이 필요하다.
- AuthDB :
- GuildDB :
- <span style="color:red"> LogDB : 이관하지 않음  </span>  >> 이관 이전의 로그 조회 시, DB에서 별도 수동 조회가 필요
- <span style="color:red"> RankDB : 이관하지 않음  </span>  >> 랭킹전 보상(일일/주간 등)의 유무 정보도 포함되는데,, 못준다고 가정을해야함
- <span style="color:red"> PvpDB : 이관하지 않음  </span>  >> 랭킹전 보상 유무가 있는데,, 초기화됨 >> 또 받을 수 있음
- <span style="color:red"> AuctionDB : 이관하지 않음  </span>  >> 이관 요청 시, 경매 정보를 유저가 수동으로 비우고 이관 요청할 수 있도록 예외 처리 추가 필요

---

### **검증 방법**
- 

---

### **공통 이슈**
- DB 마이그레이션 과정
    - DB 트랜잭션 범위가 너무 넓어질 듯 하다,, 스텝별로 트랜잭션 처리하고 스텝 순으로 DB 마이그레이션이 될 수 있도록 처리가 필요해보임. 양이 좀 되어 시간이 걸리니 진행 과정을 클라에서 표현해줘야 할 수도 있어 보인다.

    - 특히 인벤토리 같이 로우가 많은 넘들은 **userId 변환**, **데이터삽입** 시, **테이블 혹은 페이지락** 반드시 유의해야 한다.

- 문자열 Collation확인    

- 검증은?
    - 이관 케바케가 너무 방대해서 테스트 케이스를 일일이 만들 수는 없다.
    - foreginkey 없는 상태로 해당 작업을 진행하려고 하니, 무결성 체크가 불가능하다,,  
    그렇다고 지금 추가할 수도 없는 노릇이고,,


---

### **DB 별, 인덱스 중복 정리**
### AuthDB
- _User::UserId
    - GameDB 샤딩에도 연관되어 있어서, 게임 서버의 GameDB 샤딩 룰도 변경이 필요함
    - UserId 변경해 주면서,, 다른 테이블에 참조된 UserId 들도 다 변경이 필요,,ㅠㅠ
